{% extends 'base.html' %}

{% block title %}Data Manager{% endblock %}

{% block head %}
{{ super() }}

{% assets "query-builder-css" %}
<link rel="stylesheet" type="text/css" href="{{ ASSET_URL }}">
{% endassets %}

{% assets "query-builder-js" %}
<script type="text/javascript" src="{{ ASSET_URL }}"></script>
{% endassets %}
<script type="text/javascript">
    var get_filters = function(model){
        filters_result = []
        for(table in model){
            for(column in model[table]){
                column_obj = model[table][column]
                filters_result.push({
                    id: column_obj.expression,
                    label: column_obj.expression,
                    type: column_obj.type
                  })
            }
        }
        return filters_result;
    };

    var g_model = {{ model|tojson|safe }};
    var g_filters = get_filters(g_model);
    //console.log(g_model)
</script>
{% endblock %}


{% block banner %}
    <div class="banner banner-jumbotron banner-gray">
        <div class="container">
            <div class="row">
                <div class="col-md-6 center-block">
                    <h1>&nbsp;</h1>
                    <h1>Here you can transform your data and enrich it</h1>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block body %}
    <div class="row">
        <h4>Please select all the tables you wish to join together</h4>
        <div id="tables" class="">
            {% for table in model %}
                <label class="checkbox-inline col-sm-3"><input type="checkbox" id="{{table}}">{{table}}</label>
            {% endfor %}
        </div>
    </div>
    <div class="row">
        <h4>Filter your data</h4>
        <div class="col-md-12 col-lg-10 col-lg-offset-1">
            <div id="builder" class="query-builder form-inline"></div>
            <script type="text/javascript">
              var rules_basic = {
                  condition: 'AND',
                  rules: [{
                    id: 'Purchase.price',
                    operator: 'equal',
                    value: 10.25
                  }, {
                    condition: 'OR',
                    rules: [{
                      id: 'Customer.email_address',
                      operator: 'equal',
                      value: 'test@test.com'
                    }, {
                      id: 'EmlClick.Country',
                      operator: 'equal',
                      value: 'Canada'
                    }]
                  }]
                };
                //console.log(g_filters)
                $('#builder').queryBuilder({
                  plugins: ['bt-tooltip-errors'],
                  filters: g_filters,
                  rules: rules_basic
                });


    </script>
        </div>
    </div>
{% endblock %}
